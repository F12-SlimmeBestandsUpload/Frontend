<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Hello World Simple App</title>
</head>
<body>
<div>ZORG DAT JE TELEFOON OP DEZELFDE NETWERK ALS JE COMPUTER IS</div>
<img id="result"><br>
<canvas id="tex"></canvas>
</body>
<script>
  let override= null;

  // function toDataURL(url, callback){
  //   let xhr = new XMLHttpRequest();
  //   let ip = "http://"+getIpOfServer()+":8000";
  //
  //   xhr.open('get', ip+"/"+url);
  //   xhr.onload = function(){
  //     callback(this.response);
  //   };
  //
  //   xhr.send();
  // }
  //
  // toDataURL("qrcode", function(dataURL){
  //   var img = document.getElementById("result");
  //   img.src = dataURL;
  // });

  let connection_state = 0;
  const socket = new WebSocket('ws://'+getIpOfServer()+':6969');
  socket.addEventListener('message', function (event) {
    if(connection_state ==0) {
      var img = document.getElementById("result");
      img.src = event.data;
      connection_state= 1;
      return
    }


    createImageBitmap(event.data).then(imageBitmap => {
      console.log(imageBitmap);
      var myCanvas = document.getElementById('tex');
      var ctx = myCanvas.getContext('2d');
      ctx.canvas.width  = window.innerWidth;
      ctx.canvas.height = window.innerHeight;
      ctx.drawImage(imageBitmap, 0, 0, 250, 250)
    })
  });

  function getIpOfServer(){
    let ipPlusRoute = location.hostname;
    if(override!= null){
      ipPlusRoute = override;
    }
    return ipPlusRoute;
  }
</script>
</html>
